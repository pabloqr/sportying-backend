generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model admins {
  id         Int
  complex_id Int
  created_at DateTime  @default(now()) @db.Timestamp(6)
  updated_at DateTime  @default(now()) @db.Timestamp(6)
  is_delete  Boolean?  @default(false)
  complex    complexes @relation(fields: [complex_id], references: [id], onDelete: NoAction, onUpdate: NoAction)
  user       users     @relation(fields: [id], references: [id], onDelete: NoAction, onUpdate: NoAction)

  @@id([id, complex_id])
}

model courts {
  id           Int              @id @default(autoincrement())
  complex_id   Int
  sport        String           @db.VarChar
  name         String           @db.VarChar
  description  String?          @db.VarChar
  max_people   Int
  created_at   DateTime         @default(now()) @db.Timestamp(6)
  updated_at   DateTime         @default(now()) @db.Timestamp(6)
  is_delete    Boolean?         @default(false)
  complex      complexes        @relation(fields: [complex_id], references: [id], onDelete: NoAction, onUpdate: NoAction)
  devices      courts_devices[]
  status       courts_status[]
  reservations reservations[]

  @@unique([complex_id, sport, name])
}

model courts_devices {
  court_id  Int
  device_id Int
  is_delete Boolean? @default(false)
  court     courts   @relation(fields: [court_id], references: [id], onDelete: NoAction, onUpdate: NoAction)
  device    devices  @relation(fields: [device_id], references: [id], onDelete: NoAction, onUpdate: NoAction)

  @@id([court_id, device_id])
}

model courts_status {
  court_id   Int
  status     String?  @default("o") @db.VarChar(1)
  created_at DateTime @default(now()) @db.Timestamp(6)
  is_delete  Boolean? @default(false)
  court      courts   @relation(fields: [court_id], references: [id], onDelete: NoAction, onUpdate: NoAction)

  @@id([court_id, created_at])
}

model device_telemetry {
  device_id  Int
  value      Float
  created_at DateTime @default(now()) @db.Timestamp(6)
  is_delete  Boolean? @default(false)
  device     devices  @relation(fields: [device_id], references: [id], onDelete: NoAction, onUpdate: NoAction)

  @@id([device_id, created_at])
}

model devices {
  id         Int                @id @default(autoincrement())
  complex_id Int
  type       String             @default("p") @db.VarChar(1)
  status     String?            @default("n") @db.VarChar(1)
  created_at DateTime           @default(now()) @db.Timestamp(6)
  updated_at DateTime           @default(now()) @db.Timestamp(6)
  is_delete  Boolean?           @default(false)
  courts     courts_devices[]
  telemetry  device_telemetry[]
  complex    complexes          @relation(fields: [complex_id], references: [id], onDelete: NoAction, onUpdate: NoAction)
}

model notifications {
  id         Int      @default(autoincrement())
  user_id    Int
  title      String   @db.VarChar
  body       String   @db.VarChar
  severity   String   @db.VarChar(1)
  type       String   @db.VarChar(1)
  related_id Int?
  created_at DateTime @default(now()) @db.Timestamp(6)
  updated_at DateTime @default(now()) @db.Timestamp(6)
  is_delete  Boolean? @default(false)
  user       users    @relation(fields: [user_id], references: [id], onDelete: NoAction, onUpdate: NoAction)

  @@id([id, user_id, created_at])
}

model reservations {
  user_id    Int
  court_id   Int
  date_ini   DateTime @db.Timestamp(6)
  date_end   DateTime @db.Timestamp(6)
  status     String?  @default("e") @db.VarChar(1)
  created_at DateTime @default(now()) @db.Timestamp(6)
  updated_at DateTime @default(now()) @db.Timestamp(6)
  is_delete  Boolean? @default(false)
  court      courts   @relation(fields: [court_id], references: [id], onDelete: NoAction, onUpdate: NoAction)
  user       users    @relation(fields: [user_id], references: [id], onDelete: NoAction, onUpdate: NoAction)

  @@id([court_id, date_ini])
}

model users {
  id            Int             @id @default(autoincrement())
  password      String          @db.VarChar
  refresh_token String?         @db.VarChar
  role          user_role       @default(CLIENT)
  name          String          @db.VarChar
  surname       String?         @db.VarChar
  mail          String          @unique @db.VarChar
  phone_prefix  Int
  phone_number  Int
  created_at    DateTime        @default(now()) @db.Timestamp(6)
  updated_at    DateTime        @default(now()) @db.Timestamp(6)
  is_delete     Boolean?        @default(false)
  admins        admins[]
  notifications notifications[]
  reservations  reservations[]

  @@unique([phone_prefix, phone_number])
}

model complexes {
  id            Int       @id @default(autoincrement())
  complex_name  String    @db.VarChar
  time_ini      DateTime  @db.Time(6)
  time_end      DateTime  @db.Time(6)
  loc_longitude Float?
  loc_latitude  Float?
  created_at    DateTime  @default(now()) @db.Timestamp(6)
  updated_at    DateTime  @default(now()) @db.Timestamp(6)
  is_delete     Boolean?  @default(false)
  admins        admins[]
  courts        courts[]
  devices       devices[]
}

enum user_role {
  SUPERADMIN
  ADMIN
  CLIENT
}
